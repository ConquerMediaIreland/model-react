{"version":3,"file":"model-react.js","sources":["../src/cmp/BasicForm.js"],"sourcesContent":["import React, { Fragment, useEffect } from 'react'\n\nimport { useSelector } from 'react-redux'\n\nimport { Gubu, Skip, Exact, Any, Required, Value } from 'gubu'\n\n\n\nconst BasicFormShape = Gubu({\n  name: String,\n  slice: String,\n  title: Skip(String),\n  intro: Skip(String),\n  btnTitle: Skip(String),\n  field: Value({\n    name: Skip(String),\n    title: String,\n    kind: Exact('line','toggle','choice','custom'),\n    // subtype: Skip(Exact('email')),\n    subkind: Skip(String),\n    placeholder: Skip(String),\n    items: Skip([{\n      value: Required(Any()),\n      text: String,\n    }]),\n    explainer: Skip(String),\n    orient: 'vertical',\n    classes: '',\n    cmp: Any(),\n    value: Any(),\n  },{}),\n  submit: Function,\n  submitCmp: Any(),\n  // orient: Default('vertical', Exact('vertical','horizontal'))\n  orient: 'vertical',\n  classes: '',\n  valid: Skip(Function),\n  onChange: Skip(Function),\n  onRender: Skip(Function),\n})\n\n\n\nfunction BasicField(props) {\n  const field = props.field\n  const form = props.form\n  const store = props.store\n  \n  const { name, title, orient, kind } = field\n\n  const classes = 'vxg-basic-field vxg-basic-field-'+orient+\n        ' vxg-basic-field-'+kind+' '+\n        field.classes\n\n  const data = useSelector(state => state[form.slice][form.name])\n  let value = useSelector(state => state[form.slice][form.name][name])\n\n  // console.log('BasicField value', name, value, field.value, data[name])\n  value = null == value ? (null == field.value ? '' : field.value) : value\n\n  \n  const onChange = async (ev)=>{\n    let value = ev.target.value\n\n    // console.log('BasicField onChange checked',name,{...ev.target},ev.target.checked)\n    if('toggle' === field.kind && false === ev.target.checked) {\n      value = null\n    }\n\n    await store.dispatch({\n      type: form.slice + '/setFormField',\n      payload: { form: form.name, name, value: value }\n    })\n\n    let newdata = {...data}\n    newdata[name] = value\n    \n    let valid = {ok:true}\n    if(form.valid) {\n      valid = form.valid(newdata)\n    }\n\n    // console.log('FIELD onChange', field)\n    \n    if(form.onChange) {\n      form.onChange({\n        field,\n        value,\n        data:newdata,\n        meta:{valid}\n      })\n    }\n  }\n\n  \n  return (\n    <div className={classes}>\n\n      { 'toggle' === field.kind ?\n        <input\n          type=\"checkbox\"\n          id={form.name+'-'+field.name}\n          name={field.name}\n          value={field.value}\n          onChange={onChange}\n          defaultChecked={'y'===data[name]}\n        /> : <></> }\n\n      <label htmlFor={name}>{title}</label>\n\n      { 'line' === field.kind ?\n        <input\n          id={form.name+'-'+field.name}\n          name={field.name}\n          placeholder={field.placeholder}\n          value={value}\n          onChange={onChange}\n        /> : <></> }\n\n      { 'choice' === field.kind ?\n        <select\n          id={form.name+'-'+field.name}\n          name={field.name}\n          placeholder={field.placeholder}\n          value={value}\n          onChange={onChange}\n        >\n\n          { field.items.map(\n            item=>\n              <option\n                key={item.value}\n                value={item.value}\n              >\n                {item.text}\n              </option>\n          )}\n\n        </select> : <></> }\n\n      { 'custom' === field.kind ? field.cmp({onChange}) : <></> }\n\n    </div>\n  )\n}\n\n\nfunction getBasicForm(conf) {\n  let { store } = conf\n  \n  function BasicForm(props) {\n    // console.log('BasicForm A', props)\n\n    const form = BasicFormShape(props.form)\n\n    const data = useSelector(state => state[form.slice][form.name])\n    const meta = useSelector(state => state[form.slice].form[form.name])\n\n\n\n    const title = form.title\n    const intro = form.intro\n    const name = form.name\n    const slice = form.slice\n    const btnTitle = form.btnTitle\n    const blank = form.blank\n    const submit = form.submit || (() => null)\n    const submitCmp = form.submitCmp\n    const orient = form.orient\n    const classes = form.classes\n\n\n\n    const fields = Object.entries(form.field)\n          .reduce(((a,entry)=>(entry[1].name=entry[0],a.push({...entry[1]}),a)),[])\n\n    // console.log('BasicForm fields', fields)\n\n\n    let valid = {ok:true}\n    if(form.valid) {\n      valid = form.valid(data)\n    }\n\n    // if(form.onRender) {\n    //   form.onRender({data,meta:{valid}})\n    // }\n\n    \n    \n    return (\n      <form\n        name={name}\n        onSubmit={submit}\n        className={'vxg-basic-form vxg-basic-form-'+orient+' '+classes}\n      >\n        {null != title ? <h2>{title}</h2> : <></>}\n\n        {null != intro ? <p className=\"intro\">{intro}</p> : <></>}\n\n        { fields\n          .map(field =>\n               <BasicField\n                 key={field.name}\n                 field={field}\n                 form={form}\n                 store={store}\n\n               />) }\n\n        { submitCmp }\n        \n      </form>\n    )\n  }\n\n  return {\n    BasicFormShape,\n    BasicField,\n    BasicForm,\n  }\n}\n\n\nexport {\n  getBasicForm\n}\n\n"],"names":["BasicFormShape","Gubu","name","String","slice","title","Skip","intro","btnTitle","field","Value","kind","Exact","subkind","placeholder","items","value","Required","Any","text","explainer","orient","classes","cmp","submit","Function","submitCmp","valid","onChange","onRender","BasicField","props","form","store","data","useSelector","state","ev","target","checked","dispatch","type","payload","newdata","ok","meta","React","map","item","getBasicForm","conf","BasicForm","fields","Object","entries","reduce","a","entry","push"],"mappings":"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"}