{"version":3,"file":"model-react.js","sources":["../src/cmp/BasicForm.js"],"sourcesContent":["import React, { Fragment, useEffect } from 'react'\n\nimport { useSelector } from 'react-redux'\n\nimport { Gubu, Skip, Exact, Any, Required, Value } from 'gubu'\n\n\n\nconst BasicFormShape = Gubu({\n  name: String,\n  slice: String,\n  title: Skip(String),\n  intro: Skip(String),\n  btnTitle: Skip(String),\n  field: Value({\n    name: Skip(String),\n    title: String,\n    link: Skip({\n      target: String,\n      text: String,\n    }),\n    kind: Exact('line','toggle','choice','custom'),\n    // subtype: Skip(Exact('email')),\n    subkind: Skip(String),\n    placeholder: Skip(String),\n    items: Skip([{\n      value: Required(Any()),\n      text: String,\n    }]),\n    explainer: Skip(String),\n    orient: 'vertical',\n    classes: '',\n    cmp: Any(),\n    value: Any(),\n  },{}),\n  submit: Function,\n  submitCmp: Any(),\n  // orient: Default('vertical', Exact('vertical','horizontal'))\n  orient: 'vertical',\n  classes: '',\n  valid: Skip(Function),\n  onChange: Skip(Function),\n  onRender: Skip(Function),\n})\n\n\n\nfunction BasicField(props) {\n  const field = props.field\n  const form = props.form\n  const store = props.store\n\n  const { name, title, orient, kind } = field\n\n  const classes = 'vxg-basic-field vxg-basic-field-'+orient+\n        ' vxg-basic-field-'+kind+' '+\n        field.classes\n\n  const data = useSelector(state => state[form.slice][form.name])\n  let value = useSelector(state => state[form.slice][form.name][name])\n\n  // console.log('BasicField value', name, value, field.value, data[name])\n  value = null == value ? (null == field.value ? '' : field.value) : value\n\n\n  const onChange = async (ev)=>{\n    let value = ev.target.value\n\n    // console.log('BasicField onChange checked',name,{...ev.target},ev.target.checked)\n    if('toggle' === field.kind && false === ev.target.checked) {\n      value = null\n    }\n\n    await store.dispatch({\n      type: form.slice + '/setFormField',\n      payload: { form: form.name, name, value: value }\n    })\n\n    let newdata = {...data}\n    newdata[name] = value\n\n    let valid = {ok:true}\n    if(form.valid) {\n      valid = form.valid(newdata)\n    }\n\n    // console.log('FIELD onChange', field)\n\n    if(form.onChange) {\n      form.onChange({\n        field,\n        value,\n        data:newdata,\n        meta:{valid}\n      })\n    }\n  }\n\n\n  return (\n    <div className={classes}>\n\n      { 'toggle' === field.kind ?\n        <input\n          type=\"checkbox\"\n          id={form.name+'-'+field.name}\n          name={field.name}\n          value={field.value}\n          onChange={onChange}\n          defaultChecked={'y'===data[name]}\n        /> : <></> }\n\n      <label htmlFor={name}>\n        {title}\n      {\n        field.link ?\n          <a href={field.link.target} rel={'noopener noreferrer'} target={'_blank'}>\n            {' '}\n            {field.link.text}\n        </a>\n          :\n          <></>\n      }\n      </label>\n\n      { 'line' === field.kind ?\n        <input\n          id={form.name+'-'+field.name}\n          name={field.name}\n          placeholder={field.placeholder}\n          value={value}\n          onChange={onChange}\n        /> : <></> }\n\n      { 'choice' === field.kind ?\n        <select\n          id={form.name+'-'+field.name}\n          name={field.name}\n          placeholder={field.placeholder}\n          value={value}\n          onChange={onChange}\n        >\n\n          { field.items.map(\n            item=>\n              <option\n                key={item.value}\n                value={item.value}\n              >\n                {item.text}\n              </option>\n          )}\n\n        </select> : <></> }\n\n      { 'custom' === field.kind ? field.cmp({onChange}) : <></> }\n\n    </div>\n  )\n}\n\n\nfunction getBasicForm(conf) {\n  let { store } = conf\n\n  function BasicForm(props) {\n    // console.log('BasicForm A', props)\n\n    const form = BasicFormShape(props.form)\n\n    const data = useSelector(state => state[form.slice][form.name])\n    const meta = useSelector(state => state[form.slice].form[form.name])\n\n\n\n    const title = form.title\n    const intro = form.intro\n    const name = form.name\n    const slice = form.slice\n    const btnTitle = form.btnTitle\n    const blank = form.blank\n    const submit = form.submit || (() => null)\n    const submitCmp = form.submitCmp\n    const orient = form.orient\n    const classes = form.classes\n\n\n\n    const fields = Object.entries(form.field)\n          .reduce(((a,entry)=>(entry[1].name=entry[0],a.push({...entry[1]}),a)),[])\n\n    // console.log('BasicForm fields', fields)\n\n\n    let valid = {ok:true}\n    if(form.valid) {\n      valid = form.valid(data)\n    }\n\n    // if(form.onRender) {\n    //   form.onRender({data,meta:{valid}})\n    // }\n\n\n\n    return (\n      <form\n        name={name}\n        onSubmit={submit}\n        className={'vxg-basic-form vxg-basic-form-'+orient+' '+classes}\n      >\n        {null != title ? <h2>{title}</h2> : <></>}\n\n        {null != intro ? <p className=\"intro\">{intro}</p> : <></>}\n\n        { fields\n          .map(field =>\n               <BasicField\n                 key={field.name}\n                 field={field}\n                 form={form}\n                 store={store}\n\n               />) }\n\n        { submitCmp }\n\n      </form>\n    )\n  }\n\n  return {\n    BasicFormShape,\n    BasicField,\n    BasicForm,\n  }\n}\n\n\nexport {\n  getBasicForm\n}\n"],"names":["BasicFormShape","Gubu","name","String","slice","title","Skip","intro","btnTitle","field","Value","link","target","text","kind","Exact","subkind","placeholder","items","value","Required","Any","explainer","orient","classes","cmp","submit","Function","submitCmp","valid","onChange","onRender","BasicField","props","form","store","data","useSelector","state","ev","checked","dispatch","type","payload","newdata","ok","meta","React","map","item","getBasicForm","conf","BasicForm","fields","Object","entries","reduce","a","entry","push"],"mappings":"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"}