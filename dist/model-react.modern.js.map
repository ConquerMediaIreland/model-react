{"version":3,"file":"model-react.modern.js","sources":["../src/cmp/BasicForm.js"],"sourcesContent":["import React, { Fragment, useEffect } from 'react'\n\nimport { useSelector } from 'react-redux'\n\nimport { Gubu, Skip, Exact, Any, Required, Value } from 'gubu'\n\n\n\nconst BasicFormShape = Gubu({\n  name: String,\n  slice: String,\n  title: Skip(String),\n  intro: Skip(String),\n  btnTitle: Skip(String),\n  field: Value({\n    name: Skip(String),\n    title: String,\n    link: Skip({\n      target: String,\n    }),\n    kind: Exact('line','toggle','choice','custom'),\n    // subtype: Skip(Exact('email')),\n    subkind: Skip(String),\n    placeholder: Skip(String),\n    items: Skip([{\n      value: Required(Any()),\n      text: String,\n    }]),\n    explainer: Skip(String),\n    orient: 'vertical',\n    classes: '',\n    cmp: Any(),\n    value: Any(),\n  },{}),\n  submit: Function,\n  submitCmp: Any(),\n  // orient: Default('vertical', Exact('vertical','horizontal'))\n  orient: 'vertical',\n  classes: '',\n  valid: Skip(Function),\n  onChange: Skip(Function),\n  onRender: Skip(Function),\n})\n\n\n\nfunction BasicField(props) {\n  const field = props.field\n  const form = props.form\n  const store = props.store\n\n  const { name, title, orient, kind } = field\n\n  const classes = 'vxg-basic-field vxg-basic-field-'+orient+\n        ' vxg-basic-field-'+kind+' '+\n        field.classes\n\n  const data = useSelector(state => state[form.slice][form.name])\n  let value = useSelector(state => state[form.slice][form.name][name])\n\n  // console.log('BasicField value', name, value, field.value, data[name])\n  value = null == value ? (null == field.value ? '' : field.value) : value\n\n\n  const onChange = async (ev)=>{\n    let value = ev.target.value\n\n    // console.log('BasicField onChange checked',name,{...ev.target},ev.target.checked)\n    if('toggle' === field.kind && false === ev.target.checked) {\n      value = null\n    }\n\n    await store.dispatch({\n      type: form.slice + '/setFormField',\n      payload: { form: form.name, name, value: value }\n    })\n\n    let newdata = {...data}\n    newdata[name] = value\n\n    let valid = {ok:true}\n    if(form.valid) {\n      valid = form.valid(newdata)\n    }\n\n    // console.log('FIELD onChange', field)\n\n    if(form.onChange) {\n      form.onChange({\n        field,\n        value,\n        data:newdata,\n        meta:{valid}\n      })\n    }\n  }\n\n\n  return (\n    <div className={classes}>\n\n      { 'toggle' === field.kind ?\n        <input\n          type=\"checkbox\"\n          id={form.name+'-'+field.name}\n          name={field.name}\n          value={field.value}\n          onChange={onChange}\n          defaultChecked={'y'===data[name]}\n        /> : <></> }\n\n      {\n        field.link ?\n          <a href={field.link.target} rel={'noopener noreferrer'} target={'_blank'}>\n          <label htmlFor={name}>{title}</label>\n        </a>\n          :\n          <label htmlFor={name}>{title}</label>\n      }\n\n      { 'line' === field.kind ?\n        <input\n          id={form.name+'-'+field.name}\n          name={field.name}\n          placeholder={field.placeholder}\n          value={value}\n          onChange={onChange}\n        /> : <></> }\n\n      { 'choice' === field.kind ?\n        <select\n          id={form.name+'-'+field.name}\n          name={field.name}\n          placeholder={field.placeholder}\n          value={value}\n          onChange={onChange}\n        >\n\n          { field.items.map(\n            item=>\n              <option\n                key={item.value}\n                value={item.value}\n              >\n                {item.text}\n              </option>\n          )}\n\n        </select> : <></> }\n\n      { 'custom' === field.kind ? field.cmp({onChange}) : <></> }\n\n    </div>\n  )\n}\n\n\nfunction getBasicForm(conf) {\n  let { store } = conf\n\n  function BasicForm(props) {\n    // console.log('BasicForm A', props)\n\n    const form = BasicFormShape(props.form)\n\n    const data = useSelector(state => state[form.slice][form.name])\n    const meta = useSelector(state => state[form.slice].form[form.name])\n\n\n\n    const title = form.title\n    const intro = form.intro\n    const name = form.name\n    const slice = form.slice\n    const btnTitle = form.btnTitle\n    const blank = form.blank\n    const submit = form.submit || (() => null)\n    const submitCmp = form.submitCmp\n    const orient = form.orient\n    const classes = form.classes\n\n    console.log('TEST ', title)\n\n    const fields = Object.entries(form.field)\n          .reduce(((a,entry)=>(entry[1].name=entry[0],a.push({...entry[1]}),a)),[])\n\n    // console.log('BasicForm fields', fields)\n\n\n    let valid = {ok:true}\n    if(form.valid) {\n      valid = form.valid(data)\n    }\n\n    // if(form.onRender) {\n    //   form.onRender({data,meta:{valid}})\n    // }\n\n\n\n    return (\n      <form\n        name={name}\n        onSubmit={submit}\n        className={'vxg-basic-form vxg-basic-form-'+orient+' '+classes}\n      >\n        {null != title ? <h2>{title}</h2> : <></>}\n\n        {null != intro ? <p className=\"intro\">{intro}</p> : <></>}\n\n        { fields\n          .map(field =>\n               <BasicField\n                 key={field.name}\n                 field={field}\n                 form={form}\n                 store={store}\n\n               />) }\n\n        { submitCmp }\n\n      </form>\n    )\n  }\n\n  return {\n    BasicFormShape,\n    BasicField,\n    BasicForm,\n  }\n}\n\n\nexport {\n  getBasicForm\n}\n"],"names":["BasicFormShape","Gubu","name","String","slice","title","Skip","intro","btnTitle","field","Value","link","target","kind","Exact","subkind","placeholder","items","value","Required","Any","text","explainer","orient","classes","cmp","submit","Function","submitCmp","valid","onChange","onRender","BasicField","props","form","store","data","useSelector","state","ev","checked","dispatch","type","payload","newdata","ok","meta","map","item","getBasicForm","conf","BasicForm","console","log","fields","Object","entries","reduce","a","entry","push"],"mappings":"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"}